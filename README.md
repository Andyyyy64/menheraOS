## menheraOS

menheraOS用の最小OS実装。RISC-V（QEMU virt, 64-bit）をターゲットに、C言語とアセンブリで「1000行OS」流儀の構成を参考に実装する。OpenSBI（QEMUの -bios default）を利用し、Sモードからカーネルを開始する。
仕事の合間にゆっくり楽しくやっていく -> うんこ

参考: [OS in 1,000](https://operating-system-in-1000-lines.vercel.app/ja/)

## 実装する機能

- マルチタスク: 協調的マルチタスクによるプロセス切り替え
- 例外ハンドラ: トラップベクタ設定とトラップ処理
- ページング: Sv39 によるプロセス毎の仮想メモリ空間
- システムコール: ecall によるカーネル機能呼び出し（最小セット）
- デバイスドライバ: virtio-blk（ポーリング）と UART（NS16550A）
- ファイルシステム: 単純な自作FSでファイル読み書き
- コマンドラインシェル: ユーザ空間でコマンド実行

## 実装しない機能

- 割り込みによるデバイス駆動（ポーリングで代替）
- タイマーによるプリエンプティブスケジューリング
- プロセス間通信（IPC）
- マルチプロセッサ対応（単一コア想定）

## 起動構成

- QEMU が M モードで OpenSBI を起動し、S モードのペイロード（本 OS）へ制御を移す
- レジスタ: a0 = hartid, a1 = DTB(デバイスツリーの物理アドレス)
- S モード側ブートコード（`start.S`）でスタック準備、.bss クリア、`stvec` 設定、Sv39 ページングの有効化（`satp` 設定）
- `kmain()` に遷移し、UART・virtio-blk 初期化、FS マウント、プロセス初期化後 `/bin/shell` をロードしてユーザ空間へ `sret`


## ソース構成イメージ(参考丸パクリ)

```
├── disk/     - ファイルシステムの中身
├── common.c  - カーネル・ユーザー共通ライブラリ: printf, memset など
├── common.h  - カーネル・ユーザー共通: 構造体・定数定義
├── start.S   - アセンブリブートコード: OpenSBIから制御を受け取っていろいろする
├── kernel.c  - カーネル: プロセス管理、システムコール、ドライバ、FS
├── kernel.h  - カーネル: 構造体・定数定義
├── kernel.ld - カーネル用リンカスクリプト
├── shell.c   - ユーザー空間のシェル
├── user.c    - ユーザー用ライブラリ
├── user.h    - ユーザー用ヘッダ
├── user.ld   - ユーザー用リンカスクリプト
└── run.sh    - ビルド・起動スクリプト
```





